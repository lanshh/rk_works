From 39d6870a4e0e5219bc2d156b7aec269a9589b569 Mon Sep 17 00:00:00 2001
From: lanshh <lsh@rock-chips.com>
Date: Wed, 2 May 2018 09:41:04 +0800
Subject: [PATCH 1/3] for rk3326 echo show

Change-Id: Id79c1af824dfa4c8ed2c5b918eab02622f988264
Signed-off-by: lanshh <lsh@rock-chips.com>
---
 tinyalsa_hal/Android.mk | 4 ++++
 tinyalsa_hal/audio_hw.c | 2 +-
 tinyalsa_hal/audio_hw.h | 2 +-
 3 files changed, 6 insertions(+), 2 deletions(-)

diff --git a/tinyalsa_hal/Android.mk b/tinyalsa_hal/Android.mk
index 600c4a2..c2c4dbb 100755
--- a/tinyalsa_hal/Android.mk
+++ b/tinyalsa_hal/Android.mk
@@ -67,6 +67,10 @@ endif
 ifeq ($(strip $(TARGET_BOARD_PLATFORM)),rk3128)
     LOCAL_CFLAGS += -DRK3128
 endif
+ifeq ($(strip $(TARGET_BOARD_PLATFORM)),rk3326)
+    LOCAL_CFLAGS += -DRK3326
+    LOCAL_CFLAGS += -DBT_AP_SCO
+endif
 ifeq ($(strip $(TARGET_BOARD_PLATFORM_PRODUCT)), laptop)
 LOCAL_CFLAGS += -DRK3399_LAPTOP
 LOCAL_CFLAGS += -DBT_AP_SCO
diff --git a/tinyalsa_hal/audio_hw.c b/tinyalsa_hal/audio_hw.c
index 0a35b80..6e2f9c2 100755
--- a/tinyalsa_hal/audio_hw.c
+++ b/tinyalsa_hal/audio_hw.c
@@ -809,7 +809,7 @@ static int start_input_stream(struct stream_in *in)
 
     in_dump(in, 0);
     route_pcm_open(getRouteFromDevice(in->device | AUDIO_DEVICE_BIT_IN));
-#ifdef RK3399_LAPTOP //HARD CODE FIXME
+#ifdef BT_AP_SCO //HARD CODE FIXME
     if ((in->device & AUDIO_DEVICE_IN_BLUETOOTH_SCO_HEADSET) &&
             (adev->mode == AUDIO_MODE_IN_COMMUNICATION)) {
         in->config = &pcm_config_in_bt;
diff --git a/tinyalsa_hal/audio_hw.h b/tinyalsa_hal/audio_hw.h
index a81c85f..d3c417f 100755
--- a/tinyalsa_hal/audio_hw.h
+++ b/tinyalsa_hal/audio_hw.h
@@ -85,7 +85,7 @@ int PCM_CARD = 0;
 int PCM_CARD_HDMI = 1;
 int PCM_CARD_SPDIF = 2;
 #endif
-int PCM_BT = 3;
+int PCM_BT = 1;
 #define PCM_TOTAL 4
 #define PCM_DEVICE 0
 #define PCM_DEVICE_SCO 1
-- 
1.9.1

