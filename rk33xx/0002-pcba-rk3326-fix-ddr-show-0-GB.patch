From b8b2bd5538ab17551f2989326067f6eff5c93e6d Mon Sep 17 00:00:00 2001
From: lanshh <lsh@rock-chips.com>
Date: Mon, 12 Mar 2018 18:12:12 +0800
Subject: [PATCH 2/2] :pcba: rk3326: fix ddr show 0 GB

Change-Id: I63554477eb5c853cfad4de38d274c7160a3f03de
Signed-off-by: lanshh <lsh@rock-chips.com>
---
 Android.mk      | 6 ++++--
 ddr_emmc_test.c | 8 ++++----
 pre_test.c      | 6 ------
 3 files changed, 8 insertions(+), 12 deletions(-)
 mode change 100644 => 100755 ddr_emmc_test.c

diff --git a/Android.mk b/Android.mk
index 290f63b..d641d02 100755
--- a/Android.mk
+++ b/Android.mk
@@ -48,8 +48,10 @@ ifeq ($(strip $(TARGET_BOARD_PLATFORM)), rk3399)
 LOCAL_CFLAGS += -DRK3399_PCBA
 endif
 
+LOCAL_CFLAGS += -D$(strip $(TARGET_BOARD_PLATFORM))_PCBA
+
 ifeq ($(strip $(BOARD_USE_DRM)), true)
-ifneq ($(filter rk3368 rk3399 rk3288 rk3366 rk3126c, $(strip $(TARGET_BOARD_PLATFORM))), )
+ifneq ($(filter rk3368 rk3399 rk3288 rk3366 rk3126c rk3326, $(strip $(TARGET_BOARD_PLATFORM))), )
 LOCAL_CFLAGS +=-DRK_DRM_GRALLOC=1
 endif
 endif
@@ -108,7 +110,7 @@ LOCAL_SRC_FILES += \
     rk32_codec/codec_test.c
     #rk3288-camera/camera_test.c
 else
-ifeq ($(strip $(TARGET_BOARD_PLATFORM)), rk3126c)
+ifneq ($(filter rk3126c rk3326, $(strip $(TARGET_BOARD_PLATFORM))), )
 LOCAL_CFLAGS += -DRK312X_PCBA
 LOCAL_SRC_FILES += \
     alsa_mixer.c \
diff --git a/ddr_emmc_test.c b/ddr_emmc_test.c
old mode 100644
new mode 100755
index 3026da9..cfecd58
--- a/ddr_emmc_test.c
+++ b/ddr_emmc_test.c
@@ -11,7 +11,7 @@
 #define EMMCPATH0 "/sys/bus/mmc/devices/mmc0:0001/block/mmcblk0/size"
 #define EMMCPATH1 "/sys/bus/mmc/devices/mmc1:0001/block/mmcblk1/size"
 
-#if defined(RK3399_PCBA) || defined(RK3368_PCBA)
+#if defined(RK3399_PCBA) || defined(RK3368_PCBA) || defined(rk3326_PCBA)
 #define READ_DDR_COMMAND "cat /proc/zoneinfo | busybox grep present | \
 				busybox awk '{print $2}'"
 #else
@@ -98,7 +98,7 @@ void *ddr_emmc_test(void *argv)
 	ddr_ret = ddr_exec(READ_DDR_COMMAND,
 		ddrsize_char, sizeof(ddrsize_char));
 	if (ddr_ret >= 0) {
-		ddr_size = (int)(atoi(ddrsize_char)*4/1024/1024);
+		ddr_size = (int)(atoi(ddrsize_char)*4/1024);
 		/* printf("=========== ddr_zize is : %dGB
 			==========\n",ddr_size);*/
 	}
@@ -130,13 +130,13 @@ void *ddr_emmc_test(void *argv)
 			PCBA_EMMC, emmc_size);
 	} else if (ddr_ret >= 0 && emmc_ret < 0) {
 		ui_print_xy_rgba(0, tc_info->y, 255, 0, 0, 255,
-			"%s:[%s] { %s:%dGB,%s:%s }\n",
+			"%s:[%s] { %s:%dMB,%s:%s }\n",
 			PCBA_DDR_EMMC, PCBA_FAILED,
 			PCBA_DDR, ddr_size,
 			PCBA_EMMC, PCBA_FAILED);
 	} else {
 		ui_print_xy_rgba(0, tc_info->y, 0, 255, 0, 255,
-			"%s:[%s] { %s:%dGB,%s:%dGB }\n",
+			"%s:[%s] { %s:%dMB,%s:%dGB }\n",
 			PCBA_DDR_EMMC, PCBA_SECCESS,
 			PCBA_DDR, ddr_size,
 			PCBA_EMMC, emmc_size);
diff --git a/pre_test.c b/pre_test.c
index cedc7be..dabc054 100755
--- a/pre_test.c
+++ b/pre_test.c
@@ -344,12 +344,6 @@ void change_bootmode_to_nvm(int mode)
 	}
 	android_reboot(ANDROID_RB_RESTART, 0, 0);
 }
-void * camera_test(void *argc)
-{
-
-
-	return NULL;
-}
 
 int start_test_pthread(struct testcase_info *tc_info)
 {
-- 
1.9.1

